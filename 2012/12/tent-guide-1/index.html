<!DOCTYPE HTML>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Rob Sim - Tent Guide #1: Setting Up a Tent Server</title>

    <meta name="author" content="Rob Sim" />
    <meta name="description" content="Nerd, Techie, Apple Fanboy" />

    <link rel="alternate" type="application/rss+xml" href="/atom.xml" />

    <link rel="stylesheet" href="/css/style-main.css" type="text/css" media="screen and (min-device-width: 851px)" />
    <link rel="stylesheet" href="/css/style-pyg.css" type="text/css" />
    <link rel="stylesheet" href="/css/style-mobile.css" type="text/css"  media="screen and (max-device-width: 850px)" />
    <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:200,400,600' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Quicksand:300,400' rel='stylesheet' type='text/css'>
              <script type='text/javascript'>(function(){var acc='acc_1065d786_pub';var st='nocss';var or='130';var e=document.getElementsByTagName('script')[0];var d=document.createElement('script');d.src=('https:' == document.location.protocol ?'https://' : 'http://') +'engine.influads.com/show/'+or+'/'+st+'/'+acc;d.type='text/javascript';d.async=true;d.defer=true; e.parentNode.insertBefore(d,e);})();</script>
    <script type="text/javascript" src="/js/jquery.js"></script>

<script type="text/javascript">
// scroll-to-top button show and hide
jQuery(document).ready(function(){
    jQuery(window).scroll(function(){
        if (jQuery(this).scrollTop() > 100) {
            jQuery('.scrollup').fadeIn();
        } else {
            jQuery('.scrollup').fadeOut();
    }
});
// scroll-to-top animate
jQuery('.scrollup').click(function(){
    jQuery("html, body").animate({ scrollTop: 0 }, 600);
        return false;
    });
});
</script>

</head>

<body>
  
<section class="content">
  <h1>Tent Guide #1: Setting Up a Tent Server</h1><br>

  <p>This guide will detail how to set up and run your very own Tent v0.2 server on your own hardware. It will cover the proper installation and configuration on either Ubuntu Server 12.04 or an updated copy of Arch Linux. A follow-up post will detail how to use the TentStatus client (or other clients) to interact with your Tent server.</p>

<p><strong>This guide is NOT foolproof by any means and your results may vary based on architecture or the Git commit you are working from.</strong> Remember to visit <a href="http://tent.io">tent.io</a> or the <a href="https://github.com/tent/tentd-admin">GitHub repository</a> if you have any questions regarding getting your server up and running. As the software is still very experimental, don’t get discouraged if you can’t figure things out on your first go. There are a few resources from other experienced users here and there on the web if your Google-fu is strong enough. Also, make sure you replace <code>$USERNAME</code>, <code>$PASSWORD</code>, and <code>mydomain.com</code> with the appropriate values where they come up.</p>

<h2 id="install-packages">Install Packages</h2>

<p>First things first, you’ll want to make sure the following packages are installed:</p>

<p><strong>Arch:</strong> Install <a href="https://aur.archlinux.org/packages/tentd-admin-git/">tentd-admin from the AUR</a>. It will automatically clone and install the Git repository at <code>/var/lib/tentd-admin</code>.
(If you are running Arch, you will need to add <code>~/.gem/ruby/1.9.1/bin</code> to your <code>PATH</code> environment variable so you can run the gem binaries.)</p>

<p><strong>Ubuntu:</strong></p>

<pre class="highlight"><code class="language-bash">sudo apt-get install git ruby1.9.1-full libxml2 libxml2-dev libxslt1-dev build-essential postgresql postgresql-server-dev-all postgresql-client nodejs
sudo gem install bundler
sudo gem install rake</code></pre>

<h2 id="setting-up-the-postgresql-database">Setting Up the PostgreSQL Database</h2>

<p>Tent uses a PostgreSQL database to store statuses and content. We will add a PostgreSQL database and configure it to accept connections from our Tent server.</p>

<p><strong>Arch Only:</strong> First we need to initialize the database and start up the PostgreSQL server, since it is not done for us automatically. Run the following commands to do so.</p>

<pre class="highlight"><code class="language-bash">sudo mkdir /var/lib/postgres/data
sudo chown -c postgres:postgres /var/lib/postgres/data
sudo initdb -D <span class="s1">'/var/lib/postgres/data'</span>
sudo systemctl start postgresql
sudo systemctl <span class="nb">enable </span>postgresql</code></pre>

<p><strong>Arch and Ubuntu</strong>: We need to configure PostgreSQL’s default admin user and assign it a password for security purposes.</p>

<pre class="highlight"><code class="language-bash">sudo -u postgres psql postgres
<span class="se">\p</span>assword postgres</code></pre>

<p>It will ask you to set a password. Enter \d to exit this prompt when you are done.</p>

<p>Now we will create a username and password with which we will access the server’s profile configuration and other tools. This username and password will need to be entered every time you want to pair a new client application with Tent. It’s often easiest to make the username the same as what your Linux user is on your server. That way you won’t have to change the user via su whenever you need to directly access the database or change its contents.</p>

<pre class="highlight"><code class="language-bash">sudo -u postgres createuser <span class="nv">$USERNAME</span></code></pre>

<p>Next, create a new Tent database and initialize it.</p>

<pre class="highlight"><code class="language-bash">createdb tent_server</code></pre>

<p>Log into PostgreSQL and set the password you want to use when connecting to your database. If your database username created above doesn’t match that of your Linux user, you’ll need to add “sudo -u $USERNAME” in front of this command.</p>

<pre class="highlight"><code class="language-bash">psql tent_server
<span class="nv">tent_server_test</span><span class="o">=</span>&gt; ALTER ROLE <span class="nv">$USERNAME</span> ENCRYPTED PASSWORD <span class="s1">'$PASSWORD'</span>;
<span class="nv">tent_server_test</span><span class="o">=</span>&gt; <span class="se">\q</span></code></pre>

<h2 id="fetching-and-installing-the-tent-source">Fetching and Installing the Tent Source</h2>

<p><strong>Ubuntu Only:</strong> We will use Git to install the newest copy of source available for our server. Go to a location on your drive that you want your server to be based on, and that you have write access to.</p>

<pre class="highlight"><code class="language-bash">git clone https://github.com/tent/tentd-admin.git tentd-admin
<span class="nb">cd </span>tentd-admin</code></pre>

<p>Now we will install and compile the various services needed to make the Tent server run.</p>

<pre class="highlight"><code class="language-bash">bundle install</code></pre>

<p>You may experience some errors here, but usually they are accompanied by enough information to deduce the source of the problem. As of now this process works with current versions of Ubuntu 12.04, as long as you have followed the steps in this order.</p>

<p><strong>Arch and Ubuntu</strong>: CD to your install directory, then initialize the database:</p>

<pre class="highlight"><code class="language-bash"><span class="nv">DATABASE_URL</span><span class="o">=</span>postgres://<span class="nv">$USERNAME</span>:<span class="nv">$PASSWORD</span>@localhost/tent_server bundle <span class="nb">exec </span>rake db:migrate</code></pre>

<p>Now we will utter the magic words that bring our server to life (make sure it’s all on one line):</p>

<pre class="highlight"><code class="language-bash"><span class="nv">DATABASE_URL</span><span class="o">=</span>postgres://<span class="nv">$USERNAME</span>:<span class="nv">$PASSWORD</span>@localhost/tent_server <span class="nv">ADMIN_USERNAME</span><span class="o">=</span><span class="nv">$USERNAME</span> <span class="nv">ADMIN_PASSWORD</span><span class="o">=</span><span class="nv">$PASSWORD</span> bundle <span class="nb">exec </span>puma -p 3000</code></pre>

<p>Once you’ve run the above, you should see a confirmation that your server is listening for requests at http://0.0.0.0:3000. Open up a web browser and enter go to http://localhost:3000. If you are on a remote computer, use the server’s IP address instead of localhost. If you see “Tent!” then your server is operational.</p>

<p>To set up a quick profile, browse to http://localhost:3000/admin. It will prompt you for the database username and password that we set up earlier. If a screen of checkboxes comes up, click Grant Access to proceed. You will then be greeted with a series of fields that you can fill in to change your name, location, birthdate and other profile-like information.</p>

<p><img src="../../img/20121209001.png" alt=""></p>

<p>Congrats, your server is working!</p>

<p>You will notice that your server suddenly <strong>stops</strong> working if you cancel the Puma command or exit your server’s SSH session (provided that’s how you’re accessing your server). BUT you can run Puma under Screen if you first export your environment variables.</p>

<pre class="highlight"><code class="language-bash"><span class="nb">export </span><span class="nv">DATABASE_URL</span><span class="o">=</span>postgres://<span class="nv">$USERNAME</span>:<span class="nv">$PASSWORD</span>@localhost/tent_server 
<span class="nb">export </span><span class="nv">ADMIN_USERNAME</span><span class="o">=</span><span class="nv">$USERNAME</span> 
<span class="nb">export </span><span class="nv">ADMIN_PASSWORD</span><span class="o">=</span><span class="nv">$PASSWORD</span>
screen bundle <span class="nb">exec </span>puma -p 3000</code></pre>

<h2 id="separate-entity-and-server-address-under-apache">Separate Entity and Server Address under Apache</h2>

<p>In some cases it may be useful to set up your entity as being a different address than your server. For example, if you would like your Tent entity (handle) to be https://mydomain.com, but you also want your website to be served by this address. So your server would need to be positioned on something like https://tent.mydomain.com. This can be accomplished by adding the following lines into your Apache VirtualHost file(s) for your main page at mydomain.com: </p>

<pre class="highlight"><code class="language-bash">Header <span class="nb">set </span>Link <span class="s1">'&lt;https://tent.mydomain.com/profile&gt;; rel="https://tent.io/rels/profile"'</span></code></pre>

<p>Make sure the Apache mods “headers” and “proxy” are enabled. You will also need to add the <code>TENT_ENTITY</code> environment variable to your Puma command, and it should match your desired entity address. You should probably do this before you do anything with your account, like posting or following, as it may create conflicting messages in your followers’ streams with two different entities. Reload your Apache configuration and make sure your profile settings are properly set to use the right entity/server addresses, and you’re set!</p>

<hr><p>The next guide in this series will explain how to use TentStatus with your new Tent server. Stay tuned!</p>

  
</section>

  
  <a href="#" class="scrollup">Scroll</a>
  <section class="colourbar">
  </section>
  </body>
</html>

